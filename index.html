<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Dinamita POS</title>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <link rel="stylesheet" href="styles.css?v=4.0"/>
</head>
<body>
<div id="app">
  <aside class="sidebar">
    <div class="brand">
      <img id="brandLogo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxODAnIGhlaWdodD0nNDgnIHZpZXdCb3g9JzAgMCAxODAgNDgnPgogIDxyZWN0IHdpZHRoPScxODAnIGhlaWdodD0nNDgnIHJ4PScxMCcgZmlsbD0nI2ZmZmZmZicvPgogIDxyZWN0IHg9JzQnIHk9JzQnIHdpZHRoPScxNzInIGhlaWdodD0nNDAnIHJ4PSc4JyBmaWxsPScjZDAwJyBvcGFjaXR5PScwLjA4Jy8+CiAgPHRleHQgeD0nMTQnIHk9JzMwJyBmb250LXNpemU9JzIwJyBmaWxsPScjMTExJyBmb250LWZhbWlseT0nQXJpYWwgQmxhY2ssIEFyaWFsJz5ESU5BTUlUQTwvdGV4dD4KICA8dGV4dCB4PScxMjAnIHk9JzMwJyBmb250LXNpemU9JzE2JyBmaWxsPScjZDAwJyBmb250LWZhbWlseT0nQXJpYWwgQmxhY2ssIEFyaWFsJz5QT1M8L3RleHQ+Cjwvc3ZnPg==" />
      <div class="brand-title">DINAMITA POS</div>
      <small class="brand-sub">v4.0 â€¢ 2025-10-08 18:56</small>
    </div>
    <nav class="menu">
      <button data-view="dashboard" class="active">ğŸ  Dashboard</button>
      <button data-view="ventas">ğŸ›’ Ventas</button>
      <button data-view="inventario">ğŸ“¦ Inventario</button>
      <button data-view="clientes">ğŸ‘¤ Clientes</button>
      <button data-view="membresias">ğŸŸï¸ MembresÃ­as</button>
      <button data-view="cafeteria">â˜• CafeterÃ­a</button>
      <button data-view="historial">ğŸ“œ Historial</button>
      <button data-view="reportes">ğŸ“Š Reportes</button>
      <button data-view="config">âš™ï¸ ConfiguraciÃ³n</button>
      <button data-view="ticket">ğŸ§¾ Ticket 58mm</button>
    </nav>
    <div class="sidebar-footer">
      <small>DINAMITA â€¢ v4.0</small>
    </div>
  </aside>

  <main id="main">
    <div class="backdrop" id="drawerBackdrop"></div>
    <header class="topbar">
      <button id="hamburger" class="hamburger">â˜°</button>
      <h1 id="viewTitle">Dashboard</h1>
      <div class="spacer"></div>
      <button id="backupBtn" class="btn small">ğŸ’¾ Exportar respaldo</button>
      <input id="restoreInput" type="file" accept=".json" hidden>
      <button id="restoreBtn" class="btn small outline">ğŸ“¥ Importar respaldo</button>
    </header>

    <section id="view-dashboard" class="view">
      <div class="cards">
        <div class="card"><div class="card-title">ğŸ’µ Ventas de hoy</div><div class="card-value" id="kpiVentasHoy">$0</div></div>
        <div class="card"><div class="card-title">ğŸ« Tickets emitidos</div><div class="card-value" id="kpiTickets">0</div></div>
        <div class="card"><div class="card-title">ğŸ“¦ Productos en stock</div><div class="card-value" id="kpiStock">0</div></div>
        <div class="card"><div class="card-title">ğŸ“ˆ Ganancia de hoy</div><div class="card-value" id="kpiGananciaHoy">$0</div></div>
      </div>
      <div class="panel">
        <div class="panel-title">ğŸ“Š GrÃ¡ficas</div>
        <div class="chart-toolbar">
          <label>Rango: <input type="date" id="dashIni"> â€“ <input type="date" id="dashFin"></label>
          <button class="btn small" id="dashExportCsv">ğŸ“¤ Exportar CSV</button>
          <button class="btn small outline" id="dashExportPng">ğŸ–¼ï¸ Descargar imagen</button>
        </div>
        <div class="grid-2">
          <div class="chart-wrap">
            <canvas id="chartVentas"></canvas>
          </div>
          <div class="chart-wrap">
            <canvas id="chartProductos"></canvas>
          </div>
        </div>
      </div>
    </section>

    <section id="view-ventas" class="view hidden">
      <div class="panel">
        <div class="panel-title">ğŸ›ï¸ Nueva venta</div>
        <div class="grid-2">
          <div>
            <label>Tipo de venta</label>
            <select id="ventaTipo" onchange="Ventas.changeTipo()">
              <option value="producto" selected>Producto</option>
              <option value="membresia">MembresÃ­a</option>
            </select>
          </div>
          <div>
            <label>Cliente</label>
            <div class="searchbox">
              <input id="ventaClienteSearch" placeholder="PÃºblico General Â· ğŸ” Buscar nombre, tel o email" oninput="Ventas.searchCliente(this.value)" autocomplete="off">
              <div id="ventaClienteResults" class="autocomplete hidden"></div>
              <input id="ventaCliente" type="hidden" value="C1">
            </div>
          </div>
        </div>

        <div id="ventaProductoBox">
          <div class="grid-2">
            <div>
              <label>Buscar producto</label>
              <input id="ventaBuscar" placeholder="Nombre / SKU" oninput="Ventas.buscarProducto(this.value)">
              <div id="ventaResultados" class="list"></div>
            </div>
            <div>
              <label>Carrito</label>
              <div id="carrito" class="list"></div>
              <div class="totals">
                <div>Subtotal: <strong id="ventaSubtotal">$0</strong></div>
                <div>IVA (config): <strong id="ventaIVA">$0</strong></div>
                <div>Total: <strong id="ventaTotal">$0</strong></div>
              </div>
            </div>
          </div>
        </div>

        <div id="ventaMembresiaBox" class="hidden">
          <div class="grid-3">
            <div><label>Tipo</label><div style="display:flex;gap:8px"><select id="vMemTipo"></select><button class="btn small outline" onclick="Membresias.manageTipos()">âš™ï¸ Tipos</button></div></div>
            <div><label>Inicio</label><input id="vMemInicio" type="date"></div>
            <div><label>Fin</label><input id="vMemFin" type="date"></div>
            <div class="col-span-3"><label>Notas</label><input id="vMemNotas" placeholder="Notas de la membresÃ­a"></div>
          </div>
          <div class="right"><button class="btn small" onclick="Ventas.addMembresia()">â• Agregar membresÃ­a</button></div>
        </div>

        <div class="grid-2">
          <div></div>
          <div class="right">
            <button class="btn" onclick="Ventas.confirmar()">âœ… Confirmar venta</button>
          </div>
        </div>
      </div>
    </section>

    <section id="view-inventario" class="view hidden">
      <div class="panel">
        <div class="panel-title">ğŸ“¦ Inventario</div>
        <div class="grid-3">
          <div><label>SKU</label><input id="prodSku" placeholder="SKU-001"></div>
          <div><label>Nombre</label><input id="prodNombre" placeholder="ProteÃ­na Whey"></div>
          <div><label>CategorÃ­a</label><input id="prodCategoria" placeholder="Suplementos / Accesorios / CafeterÃ­a"></div>
          <div><label>Precio (MXN)</label><input id="prodPrecio" type="number" min="0" step="0.01"></div>
          <div><label>Costo (MXN)</label><input id="prodCosto" type="number" min="0" step="0.01"></div>
          <div><label>Stock</label><input id="prodStock" type="number" min="0" step="1"></div>
          <div><label>Imagen</label><input id="prodImg" type="file" accept="image/*" onchange="Inventario.loadImage(this)"></div>
          <div class="col-span-3"><label>DescripciÃ³n</label><textarea id="prodDescr" rows="2"></textarea></div>
          <div class="col-span-3 right"><button class="btn" onclick="Inventario.guardar()">ğŸ’¾ Guardar / Actualizar</button><button class="btn outline" onclick="Inventario.limpiar()">ğŸ§¹ Limpiar</button></div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-title">ğŸ“ƒ Listado</div>
        <div class="filters">
          <input id="invSearch" placeholder="Buscar..." oninput="Inventario.renderTabla()">
          <select id="invCat" onchange="Inventario.renderTabla()"><option value="">Todas</option><option>Suplementos</option><option>Accesorios</option><option>CafeterÃ­a</option></select>
          <button class="btn small" onclick="Inventario.exportCSV()">ğŸ“¤ Exportar CSV</button>
        </div>
        <div id="invTabla" class="table"></div>
      </div>
    </section>

    <section id="view-clientes" class="view hidden">
      <div class="panel">
        <div class="panel-title">ğŸ‘¤ Clientes</div>
        <div class="grid-3">
          <input id="cliId" type="hidden">
          <div><label>Nombre</label><input id="cliNombre"></div>
          <div><label>TelÃ©fono</label><input id="cliTel"></div>
          <div><label>Email</label><input id="cliEmail"></div>
          <div><label><input type="checkbox" id="cliCertMed"> Presenta certificado mÃ©dico</label></div>
          <div><label><input type="checkbox" id="cliEntrenaSolo"> Entrena por su cuenta</label></div>
          <div></div>
          <div class="col-span-3 right"><button class="btn" onclick="Clientes.guardar()">ğŸ’¾ Guardar / Actualizar</button><button class="btn outline" onclick="Clientes.limpiar()">ğŸ§¹ Limpiar</button></div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-title">ğŸ“ƒ Listado</div>
        <div class="filters"><input id="cliSearch" placeholder="Buscar..." oninput="Clientes.renderTabla()"><button class="btn small" onclick="Clientes.exportCSV()">ğŸ“¤ Exportar CSV</button></div>
        <div id="cliTabla" class="table"></div>
      </div>
    </section>

    <section id="view-membresias" class="view hidden">
      <div class="panel">
        <div class="panel-title">ğŸŸï¸ Registrar MembresÃ­a</div>
        <div class="grid-3">
          <div><label>Cliente</label>
            <div class="searchbox">
              <input id="memClienteSearch" placeholder="ğŸ” Buscar nombre, tel o email" oninput="Membresias.searchCliente(this.value)" autocomplete="off">
              <div id="memClienteResults" class="autocomplete hidden"></div>
              <input id="memClienteId" type="hidden">
            </div>
          </div>
          <div><label>Tipo</label><div style="display:flex;gap:8px"><select id="memTipo" onchange="Membresias.changeTipo()"></select><button class="btn small outline" onclick="Membresias.manageTipos()">âš™ï¸ Tipos</button></div></div>
          <div><label>Inicio</label><input id="memInicio" type="date"></div>
          <div><label>Fin</label><input id="memFin" type="date"></div>
          <div><label>Notas</label><input id="memNotas"></div>
          <div class="right"><button class="btn" onclick="Membresias.guardar()">ğŸ’¾ Guardar</button> <button class="btn outline" onclick="Membresias.cobrarAqui()">ğŸ’° Cobrar aquÃ­</button></div>
        </div>
      </div>
      <div class="panel">
        <div class="panel-title">ğŸŸï¸ MembresÃ­as</div>
        <div class="filters">
          <input id="memSearch" placeholder="Buscar cliente..." oninput="Membresias.renderTabla()">
          <select id="memStatus" onchange="Membresias.renderTabla()"><option value="">Todos</option><option value="activa">Activas</option><option value="vencida">Vencidas</option><option value="prÃ³xima">PrÃ³x. a vencer</option></select>
          <button class="btn small" onclick="Membresias.exportCSV()">ğŸ“¤ Exportar CSV</button>
        </div>
        <div id="memTabla" class="table"></div>
      </div>
    </section>

    <section id="view-cafeteria" class="view hidden"><div class="panel"><div class="panel-title">â˜• CafeterÃ­a</div><div id="cafGrid" class="catalog"></div></div></section>

    <section id="view-historial" class="view hidden">
      <div class="panel">
        <div class="panel-title">ğŸ“œ Historial de ventas</div>
        <div class="filters"><button class="btn small" onclick="Historial.openFiltros()">ğŸ” Filtros</button><button class="btn small" onclick="Historial.exportCSV()">ğŸ“¤ Exportar CSV</button></div>
        <div id="histTabla" class="table"></div>
      </div>
    </section>

    <section id="view-reportes" class="view hidden">
      <div class="panel">
        <div class="panel-title">ğŸ“Š Reportes</div>
        <div class="tabs">
          <div class="tab active" data-tab="rep-ventas" onclick="Reportes.show('rep-ventas', this)">Ventas</div>
          <div class="tab" data-tab="rep-membresias" onclick="Reportes.show('rep-membresias', this)">MembresÃ­as</div>
          <div class="tab" data-tab="rep-inventario" onclick="Reportes.show('rep-inventario', this)">Inventario</div>
          <div class="tab" data-tab="rep-tops" onclick="Reportes.show('rep-tops', this)">Tops</div>
        </div>

        <div id="rep-ventas" class="rep-pane">
          <div class="filters">
            <label>De <input type="date" id="repVenIni"></label>
            <label>A <input type="date" id="repVenFin"></label>
            <button class="btn small" onclick="Reportes.renderVentas()">Actualizar</button>
            <button class="btn small" onclick="Reportes.exportVentas()">ğŸ“¤ Exportar CSV</button>
          </div>
          <div id="repVenKpi" class="cards"></div>
          <div id="repVenTabla" class="table"></div>
        </div>

        <div id="rep-membresias" class="rep-pane hidden">
          <div class="filters">
            <label>De <input type="date" id="repMemIni"></label>
            <label>A <input type="date" id="repMemFin"></label>
            <button class="btn small" onclick="Reportes.renderMembresias()">Actualizar</button>
            <button class="btn small" onclick="Reportes.exportMembresias()">ğŸ“¤ Exportar CSV</button>
          </div>
          <div id="repMemKpi" class="cards"></div>
          <div id="repMemTabla" class="table"></div>
        </div>

        <div id="rep-inventario" class="rep-pane hidden">
          <div class="filters">
            <button class="btn small" onclick="Inventario.exportCSV()">ğŸ“¤ Exportar CSV</button>
          </div>
          <div id="repInvTabla" class="table"></div>
        </div>

        <div id="rep-tops" class="rep-pane hidden">
          <div class="grid-2">
            <div class="chart-wrap"><canvas id="topProductos"></canvas></div>
            <div class="chart-wrap"><canvas id="topMembresias"></canvas></div>
          </div>
          <div class="chart-wrap mt-2"><canvas id="topClientes"></canvas></div>
        </div>
      </div>
    </section>

    <section id="view-config" class="view hidden">
      <div class="panel">
        <div class="panel-title">âš™ï¸ ConfiguraciÃ³n</div>
        <div class="grid-3">
          <div class="col-span-3"><strong>ğŸ¨ Apariencia</strong></div>
          <div><label>Fondo (bg)</label><input id="cfgBg" type="color"></div>
          <div><label>Panel</label><input id="cfgPanel" type="color"></div>
          <div><label>MenÃº</label><input id="cfgMenu" type="color"></div>
          <div><label>Primario</label><input id="cfgPrimary" type="color"></div>
          <div><label>Texto</label><input id="cfgText" type="color"></div>
          <div><label>Subtexto</label><input id="cfgSub" type="color"></div>
          <div class="col-span-3 right">
            <button class="btn small" onclick="Config.guardarTema()">ğŸ’¾ Guardar tema</button>
            <button class="btn small outline" onclick="Config.resetTema()">â†©ï¸ Restablecer tema Dinamita</button>
          </div>

          <div class="col-span-3"><strong>ğŸ§¾ Ticket</strong></div>
          <div><label>IVA (%)</label><input id="cfgIVA" type="number" step="1"></div>
          <div class="col-span-3"><label>Mensaje del ticket (pie)</label><input id="cfgMensaje"></div>
          <div><label>Logo</label><input type="file" accept="image/*" onchange="Config.loadLogo(this)"></div>
          <div><label>Nombre</label><input id="cfgBizName"></div>
          <div><label>DirecciÃ³n</label><input id="cfgBizAddr"></div>
          <div><label>TelÃ©fono</label><input id="cfgBizTel"></div>
          <div><label>Email</label><input id="cfgBizEmail"></div>
          <div><label>Redes</label><input id="cfgBizSocial"></div>
          <div class="col-span-3 right">
            <button class="btn" onclick="Config.guardar()">ğŸ’¾ Guardar</button>
            <button class="btn outline" onclick="Config.reset()">â†©ï¸ Restablecer</button>
          </div>
        </div>
      </div>
    </section>

    <section id="view-ticket" class="view hidden">
      <div class="panel">
        <div class="panel-title">ğŸ§¾ Vista previa de ticket 58mm</div>
        <div class="ticket" id="ticketPreview">
          <div class="t-logo"><img id="ticketLogo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxODAnIGhlaWdodD0nNDgnIHZpZXdCb3g9JzAgMCAxODAgNDgnPgogIDxyZWN0IHdpZHRoPScxODAnIGhlaWdodD0nNDgnIHJ4PScxMCcgZmlsbD0nI2ZmZmZmZicvPgogIDxyZWN0IHg9JzQnIHk9JzQnIHdpZHRoPScxNzInIGhlaWdodD0nNDAnIHJ4PSc4JyBmaWxsPScjZDAwJyBvcGFjaXR5PScwLjA4Jy8+CiAgPHRleHQgeD0nMTQnIHk9JzMwJyBmb250LXNpemU9JzIwJyBmaWxsPScjMTExJyBmb250LWZhbWlseT0nQXJpYWwgQmxhY2ssIEFyaWFsJz5ESU5BTUlUQTwvdGV4dD4KICA8dGV4dCB4PScxMjAnIHk9JzMwJyBmb250LXNpemU9JzE2JyBmaWxsPScjZDAwJyBmb250LWZhbWlseT0nQXJpYWwgQmxhY2ssIEFyaWFsJz5QT1M8L3RleHQ+Cjwvc3ZnPg=="></div>
          <div class="t-title" id="tBizName">DINAMITA GYM</div>
          <div class="t-sub" id="tBizInfo"></div>
          <div class="t-body" id="ticketBody"><div>Sin ventas recientes</div></div>
        </div>
        <div class="right mt-2"><button class="btn" onclick="Tickets.print()">ğŸ–¨ï¸ Imprimir</button></div>
      </div>
    </section>

    <div id="modalFiltros" class="modal hidden" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-head">
          <h3>ğŸ” Filtros de bÃºsqueda</h3>
          <button class="icon-btn" onclick="Historial.closeFiltros()">âœ•</button>
        </div>
        <div class="modal-grid">
          <label>Fecha inicio<input type="date" id="histFechaIni"></label>
          <label>Fecha fin<input type="date" id="histFechaFin"></label>
          <label>Folio<input id="histFolio" placeholder="Ej: T3054418"></label>
          <label>Cliente<input id="histCliente" placeholder="Nombre / Tel"></label>
          <label>Producto<input id="histProducto" placeholder="Ej: Shaker"></label>
          <label>Forma de pago<select id="histPago"><option value=''>Todas</option><option>Efectivo</option><option>Tarjeta</option><option>Transferencia</option><option>Mixto</option></select></label>
        </div>
        <div class="actions"><button class="btn" onclick="Historial.applyFiltros()">âœ… Aplicar</button><button class="btn outline" onclick="Historial.clearFiltros()">ğŸ§¹ Limpiar</button><button class="btn danger" onclick="Historial.closeFiltros()">âŒ Cerrar</button></div>
      </div>
    </div>

  
    <div id="modalTipos" class="modal hidden" aria-hidden="true">
      <div class="modal-content">
        <div class="modal-head">
          <h3>âš™ï¸ Tipos de membresÃ­a</h3>
          <button class="icon-btn" onclick="Membresias.closeTipos()">âœ•</button>
        </div>
        <div id="tiposList" class="modal-grid"></div>
        <div class="modal-grid" style="margin-top:12px">
          <label>Nombre<input id="tipoNombre"></label>
          <label>DÃ­as<input id="tipoDias" type="number" min="0"></label>
          <label>Precio<input id="tipoPrecio" type="number" min="0" step="0.01"></label>
        </div>
        <div class="actions">
          <button class="btn" onclick="Membresias.addTipo()">â• Agregar</button>
          <button class="btn outline" onclick="Membresias.closeTipos()">Cerrar</button>
        </div>
      </div>
    </div>
    
</main>
</div>
<script>const DEFAULT_LOGO = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPScxODAnIGhlaWdodD0nNDgnIHZpZXdCb3g9JzAgMCAxODAgNDgnPgogIDxyZWN0IHdpZHRoPScxODAnIGhlaWdodD0nNDgnIHJ4PScxMCcgZmlsbD0nI2ZmZmZmZicvPgogIDxyZWN0IHg9JzQnIHk9JzQnIHdpZHRoPScxNzInIGhlaWdodD0nNDAnIHJ4PSc4JyBmaWxsPScjZDAwJyBvcGFjaXR5PScwLjA4Jy8+CiAgPHRleHQgeD0nMTQnIHk9JzMwJyBmb250LXNpemU9JzIwJyBmaWxsPScjMTExJyBmb250LWZhbWlseT0nQXJpYWwgQmxhY2ssIEFyaWFsJz5ESU5BTUlUQTwvdGV4dD4KICA8dGV4dCB4PScxMjAnIHk9JzMwJyBmb250LXNpemU9JzE2JyBmaWxsPScjZDAwJyBmb250LWZhbWlseT0nQXJpYWwgQmxhY2ssIEFyaWFsJz5QT1M8L3RleHQ+Cjwvc3ZnPg==";</script>
<script src="app.js?v=4.1"></script>
<script>
// drawer toggle
document.addEventListener('DOMContentLoaded',()=>{
  const btn=document.getElementById('hamburger');
  const bd=document.body;
  const backdrop=document.getElementById('drawerBackdrop');
  const close=()=>bd.classList.remove('drawer-open');
  btn.addEventListener('click',()=>bd.classList.toggle('drawer-open'));
  backdrop.addEventListener('click',close);
});
</script>
</body>
</html>
